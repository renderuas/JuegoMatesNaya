{% extends "base.html" %}

{% block content %}
<div class="game-container">
    <h2>{{ _('Fun Math Game') }}</h2>
    <div id="problem" class="problem"></div>
    <input type="text" id="answer" class="answer-input" placeholder="{{ _('Type your answer here') }}">
    <button id="submit-btn" class="submit-btn">{{ _('Check My Answer') }}</button>
    <div id="feedback" class="feedback"></div>
    <div id="score" class="score">{{ _('Your Score: 0') }}</div>
</div>

<script>
let currentProblemId = null;

function getProblem() {
    fetch('/get_problem', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ difficulty: 1 }),
    })
    .then(response => response.json())
    .then(data => {
        currentProblemId = data.id;
        document.getElementById('problem').textContent = data.question;
        document.getElementById('answer').value = '';
        document.getElementById('feedback').textContent = '';
    });
}

function checkAnswer() {
    const userAnswer = document.getElementById('answer').value;
    
    fetch('/check_answer', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            problem_id: currentProblemId,
            answer: userAnswer
        }),
    })
    .then(response => response.json())
    .then(data => {
        const feedbackElement = document.getElementById('feedback');
        if (data.correct) {
            feedbackElement.textContent = '{{ _("Yay!") }} ' + data.explanation;
            feedbackElement.className = 'feedback correct';
        } else {
            feedbackElement.textContent = '{{ _("Oops!") }} ' + data.explanation + ' {{ _("Try again!") }}';
            feedbackElement.className = 'feedback incorrect';
        }
        document.getElementById('score').textContent = '{{ _("Your Score:") }} ' + data.score;
        
        // Get next problem after a short delay
        setTimeout(getProblem, 3000);
    });
}

// Initialize the game
document.addEventListener('DOMContentLoaded', function() {
    getProblem();
    document.getElementById('submit-btn').addEventListener('click', checkAnswer);
});
</script>
{% endblock %}
